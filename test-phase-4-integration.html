<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 4 Integration Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .test-section {
            padding: 30px;
            border-bottom: 1px solid #eee;
        }
        
        .test-section:last-child {
            border-bottom: none;
        }
        
        .test-button {
            background: #10B981;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            margin: 5px;
        }
        
        .test-button:hover {
            background: #059669;
        }
        
        .test-button:disabled {
            background: #9CA3AF;
            cursor: not-allowed;
        }
        
        .results {
            margin-top: 20px;
            padding: 15px;
            background: #F9FAFB;
            border-radius: 8px;
            border: 1px solid #E5E7EB;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            white-space: pre-wrap;
        }
        
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status.success { background: #D1FAE5; color: #065F46; }
        .status.error { background: #FEE2E2; color: #991B1B; }
        .status.info { background: #DBEAFE; color: #1E40AF; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Phase 4: Webflow Integration Bridge</h1>
            <p>Testing configuration upload endpoints and hot-reloading functionality</p>
        </div>
        
        <div class="test-section">
            <h2>üîß API Endpoints Test</h2>
            <p>Test the new configuration upload and GitHub commit endpoints.</p>
            <button class="test-button" onclick="testConfigUpload()">Test Config Upload</button>
            <button class="test-button" onclick="testGitHubCommit()">Test GitHub Commit</button>
            <button class="test-button" onclick="runAllTests()">Run All API Tests</button>
            <div id="api-results" class="results" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h2>üîÑ Hot-Reload Test</h2>
            <p>Test configuration hot-reloading functionality.</p>
            <button class="test-button" onclick="testConfigReload()">Test Config Reload</button>
            <button class="test-button" onclick="simulateConfigChange()">Simulate Config Change</button>
            <div id="reload-results" class="results" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h2>üìã Test Configuration Generator</h2>
            <p>Generate test configurations for different scenarios.</p>
            <button class="test-button" onclick="generateTestConfig('basic')">Basic Config</button>
            <button class="test-button" onclick="generateTestConfig('advanced')">Advanced Config</button>
            <button class="test-button" onclick="generateTestConfig('performance')">Performance Config</button>
            <div id="config-results" class="results" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h2>üåê Webflow Integration Test</h2>
            <p>Test the enhanced Webflow embed code functionality.</p>
            <div id="webflow-test-container" style="min-height: 200px; background: #f8f9fa; border-radius: 8px; margin: 20px 0;"></div>
            <button class="test-button" onclick="loadWebflowEmbed()">Load Webflow Embed</button>
            <button class="test-button" onclick="testUpdateIndicator()">Test Update Indicator</button>
            <div id="webflow-results" class="results" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h2>üìä Phase 4 Summary</h2>
            <div id="phase-summary">
                <p><span class="status info">READY</span> Click "Run Full Phase 4 Test" to test all components</p>
            </div>
            <button class="test-button" onclick="runFullPhase4Test()" style="background: #7C3AED;">üß™ Run Full Phase 4 Test</button>
        </div>
    </div>

    <!-- Load the test script -->
    <script src="/test-phase-4-api.js"></script>
    
    <script>
        let testResults = {
            apiEndpoints: false,
            hotReload: false,
            webflowIntegration: false,
            configGeneration: false
        };

        function showResults(containerId, content, type = 'info') {
            const container = document.getElementById(containerId);
            container.style.display = 'block';
            container.textContent = content;
            container.style.color = type === 'error' ? '#991B1B' : (type === 'success' ? '#065F46' : '#1E40AF');
        }

        // Configuration upload test
        async function testConfigUpload() {
            showResults('api-results', 'Testing configuration upload...', 'info');
            
            try {
                const result = await window.phase4Tests.testConfigUpload();
                if (result && result.success) {
                    showResults('api-results', `‚úÖ Config Upload PASSED\n${JSON.stringify(result, null, 2)}`, 'success');
                    testResults.apiEndpoints = true;
                } else {
                    showResults('api-results', `‚ùå Config Upload FAILED\n${JSON.stringify(result, null, 2)}`, 'error');
                }
            } catch (error) {
                showResults('api-results', `‚ùå Config Upload ERROR\n${error.message}`, 'error');
            }
        }

        // GitHub commit test
        async function testGitHubCommit() {
            showResults('api-results', 'Testing GitHub commit endpoint...', 'info');
            
            try {
                const result = await window.phase4Tests.testGitHubCommit();
                if (result && result.success) {
                    showResults('api-results', `‚úÖ GitHub Commit PASSED\n${JSON.stringify(result, null, 2)}`, 'success');
                } else {
                    showResults('api-results', `‚ùå GitHub Commit FAILED\n${JSON.stringify(result, null, 2)}`, 'error');
                }
            } catch (error) {
                showResults('api-results', `‚ùå GitHub Commit ERROR\n${error.message}`, 'error');
            }
        }

        // Run all API tests
        async function runAllTests() {
            showResults('api-results', 'Running all API endpoint tests...', 'info');
            await window.phase4Tests.runAllTests();
        }

        // Test configuration reload
        async function testConfigReload() {
            showResults('reload-results', 'Testing configuration reload...', 'info');
            
            if (window.webflow3DScene && window.webflow3DScene.reload) {
                try {
                    await window.webflow3DScene.reload();
                    showResults('reload-results', '‚úÖ Configuration reload PASSED\n3D scene reloaded successfully', 'success');
                    testResults.hotReload = true;
                } catch (error) {
                    showResults('reload-results', `‚ùå Configuration reload FAILED\n${error.message}`, 'error');
                }
            } else {
                showResults('reload-results', '‚ö†Ô∏è 3D scene not available for reload test\nThis is normal if no 3D scene is loaded', 'info');
            }
        }

        // Simulate configuration change
        function simulateConfigChange() {
            showResults('reload-results', 'Simulating configuration change...', 'info');
            
            // Simulate the update indicator
            setTimeout(() => {
                if (typeof showConfigUpdateIndicator !== 'undefined') {
                    showConfigUpdateIndicator();
                    showResults('reload-results', '‚úÖ Configuration change simulation PASSED\nUpdate indicator should appear', 'success');
                } else {
                    showResults('reload-results', '‚ö†Ô∏è Update indicator function not available\nThis is normal in this test environment', 'info');
                }
            }, 1000);
        }

        // Generate test configurations
        function generateTestConfig(type) {
            showResults('config-results', `Generating ${type} configuration...`, 'info');
            
            const configs = {
                basic: {
                    version: "1.0.0",
                    camera: {
                        position: [100, 50, 100],
                        target: [0, 0, 0],
                        distance: 120,
                        fov: 75
                    },
                    lighting: {
                        ambient: { color: "#ffffff", intensity: 0.4 }
                    }
                },
                advanced: {
                    version: "1.0.0",
                    camera: {
                        position: [150, 75, 150],
                        target: [0, 0, 0],
                        distance: 180,
                        fov: 60,
                        minDistance: 20,
                        maxDistance: 400
                    },
                    lighting: {
                        ambient: { color: "#ffffff", intensity: 0.3 },
                        directional: { color: "#ffffff", intensity: 0.9, position: [1, 1, 0] }
                    },
                    animations: {
                        autoplay: true,
                        speed: 1.2,
                        loop: true
                    }
                },
                performance: {
                    version: "1.0.0",
                    camera: {
                        position: [80, 40, 80],
                        target: [0, 0, 0],
                        distance: 100,
                        fov: 80
                    },
                    performance: {
                        qualityLevel: "medium",
                        maxTriangles: 50000,
                        targetFPS: 30
                    }
                }
            };

            const config = configs[type];
            if (config) {
                showResults('config-results', `‚úÖ ${type.toUpperCase()} Configuration Generated\n${JSON.stringify(config, null, 2)}`, 'success');
                testResults.configGeneration = true;
            } else {
                showResults('config-results', `‚ùå Unknown configuration type: ${type}`, 'error');
            }
        }

        // Load Webflow embed simulation
        function loadWebflowEmbed() {
            showResults('webflow-results', 'Loading Webflow embed simulation...', 'info');
            
            const container = document.getElementById('webflow-test-container');
            container.innerHTML = `
                <div style="padding: 20px; text-align: center; color: #666;">
                    <div style="font-size: 24px; margin-bottom: 10px;">üèóÔ∏è</div>
                    <div>Webflow 3D Integration</div>
                    <div style="font-size: 12px; margin-top: 5px;">Enhanced embed code loaded</div>
                </div>
            `;
            
            setTimeout(() => {
                showResults('webflow-results', '‚úÖ Webflow embed simulation PASSED\nEmbed code loaded successfully', 'success');
                testResults.webflowIntegration = true;
            }, 1000);
        }

        // Test update indicator
        function testUpdateIndicator() {
            showResults('webflow-results', 'Testing update indicator...', 'info');
            
            // Create a simulated update indicator
            const indicator = document.createElement('div');
            indicator.id = 'test-update-indicator';
            indicator.innerHTML = `
                <div style="
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: linear-gradient(135deg, #10B981 0%, #059669 100%);
                    color: white;
                    padding: 12px 20px;
                    border-radius: 12px;
                    box-shadow: 0 8px 32px rgba(16, 185, 129, 0.3);
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
                    font-size: 14px;
                    font-weight: 500;
                    z-index: 10000;
                    cursor: pointer;
                " onclick="this.parentElement.remove()">
                    ‚ú® Configuration Updated (Test)
                    <div style="font-size: 12px; opacity: 0.9; margin-top: 4px;">
                        Click to dismiss
                    </div>
                </div>
            `;
            
            document.body.appendChild(indicator);
            
            setTimeout(() => {
                showResults('webflow-results', '‚úÖ Update indicator test PASSED\nIndicator should appear in top-right corner', 'success');
                
                // Auto-remove after 5 seconds
                setTimeout(() => {
                    const elem = document.getElementById('test-update-indicator');
                    if (elem) elem.remove();
                }, 5000);
            }, 500);
        }

        // Run full Phase 4 test
        async function runFullPhase4Test() {
            const summaryDiv = document.getElementById('phase-summary');
            summaryDiv.innerHTML = '<p><span class="status info">RUNNING</span> Executing full Phase 4 test suite...</p>';
            
            // Reset results
            testResults = {
                apiEndpoints: false,
                hotReload: false,
                webflowIntegration: false,
                configGeneration: false
            };
            
            // Run all tests
            await testConfigUpload();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testGitHubCommit();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testConfigReload();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            generateTestConfig('advanced');
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            loadWebflowEmbed();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            testUpdateIndicator();
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            // Generate summary
            const passed = Object.values(testResults).filter(Boolean).length;
            const total = Object.keys(testResults).length;
            
            let summaryHTML = `
                <h3>Phase 4 Test Results (${passed}/${total} passed)</h3>
                <p><span class="status ${testResults.apiEndpoints ? 'success' : 'error'}">${testResults.apiEndpoints ? '‚úÖ' : '‚ùå'}</span> API Endpoints</p>
                <p><span class="status ${testResults.hotReload ? 'success' : 'info'}">${testResults.hotReload ? '‚úÖ' : '‚ö†Ô∏è'}</span> Hot Reload</p>
                <p><span class="status ${testResults.webflowIntegration ? 'success' : 'error'}">${testResults.webflowIntegration ? '‚úÖ' : '‚ùå'}</span> Webflow Integration</p>
                <p><span class="status ${testResults.configGeneration ? 'success' : 'error'}">${testResults.configGeneration ? '‚úÖ' : '‚ùå'}</span> Config Generation</p>
                <br>
                <p><span class="status ${passed === total ? 'success' : (passed > total/2 ? 'info' : 'error')}">
                    ${passed === total ? 'ALL TESTS PASSED' : passed > total/2 ? 'MOSTLY WORKING' : 'NEEDS ATTENTION'}
                </span></p>
            `;
            
            summaryDiv.innerHTML = summaryHTML;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üß™ Phase 4 Integration Test loaded');
            console.log('Available test functions:', Object.keys(window.phase4Tests || {}));
        });
    </script>
</body>
</html>