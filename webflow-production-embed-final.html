<!-- PRODUCTION-READY Webflow Embed Code - Fixed Version -->
<script>
(function() {
  // Configuration URL for hot-reloading
  const configUrl = 'https://joaopdecarvalho.github.io/webflow-gunther-map/config/3d-config.json';
  
  // FORCE PRODUCTION MODE - GitHub Pages URLs
  window.SCRIPT_BASE_URL = 'https://joaopdecarvalho.github.io/webflow-gunther-map/src';
  
  // Use production URLs (GitHub Pages)
  const baseUrl = 'https://joaopdecarvalho.github.io/webflow-gunther-map/src';
  
  let configCheckInterval;
  
  async function checkForConfigUpdates() {
    try {
      const response = await fetch(configUrl + '?v=' + Date.now(), {
        method: 'HEAD',
        cache: 'no-cache'
      });
      
      const lastModified = response.headers.get('Last-Modified') || response.headers.get('ETag');
      const storedVersion = localStorage.getItem('3d-config-last-modified');
      
      if (lastModified && lastModified !== storedVersion) {
        console.log('ðŸ”„ New configuration detected, updating...');
        localStorage.setItem('3d-config-last-modified', lastModified);
        showConfigUpdateIndicator();
        if (window.webflow3DScene && window.webflow3DScene.reload) {
          window.webflow3DScene.reload();
        }
      }
    } catch (error) {
      console.log('Configuration check failed (normal if offline):', error.message);
    }
  }
  
  function showConfigUpdateIndicator() {
    const existing = document.getElementById('webflow-3d-update-indicator');
    if (existing) existing.remove();
    
    const indicator = document.createElement('div');
    indicator.id = 'webflow-3d-update-indicator';
    indicator.innerHTML = `
      <div style="
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #10B981 0%, #059669 100%);
        color: white;
        padding: 12px 20px;
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(16, 185, 129, 0.3);
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
        font-size: 14px;
        font-weight: 500;
        z-index: 10000;
        cursor: pointer;
        user-select: none;
      " onclick="this.parentElement.remove()">
        âœ¨ 3D Configuration Updated
        <div style="font-size: 12px; opacity: 0.9; margin-top: 4px;">
          Click to dismiss
        </div>
      </div>
    `;
    document.body.appendChild(indicator);
    setTimeout(() => {
      const elem = document.getElementById('webflow-3d-update-indicator');
      if (elem) elem.remove();
    }, 5000);
  }
  
  function initConfigMonitoring() {
    checkForConfigUpdates();
    configCheckInterval = setInterval(checkForConfigUpdates, 30000);
    window.addEventListener('beforeunload', () => {
      if (configCheckInterval) clearInterval(configCheckInterval);
    });
  }
  
  window.globalScripts = ['alert'];
  window.pageScripts = ['3d-map-final'];  // Add 3D map script for homepage
  
  // Load the router from production GitHub Pages
  const script = document.createElement('script');
  script.src = baseUrl + '/router.js';
  script.onerror = function() {
    console.error('Failed to load 3D map scripts.');
    // Show fallback message
    const container = document.querySelector('[data-webflow-3d-container]') || document.body;
    const errorDiv = document.createElement('div');
    errorDiv.style.cssText = `
      background: #fee;
      border: 1px solid #fcc;
      color: #c33;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      text-align: center;
      font-family: Arial, sans-serif;
    `;
    errorDiv.innerHTML = 'Failed to load 3D map. Please refresh the page.';
    container.appendChild(errorDiv);
  };
  
  script.onload = function() {
    console.log('âœ… 3D Map router loaded from GitHub Pages');
    // Initialize config monitoring after scripts load
    setTimeout(initConfigMonitoring, 1000);
  };
  
  document.head.appendChild(script);
})();
</script>