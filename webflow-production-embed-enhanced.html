<!-- Script Router System - Environment-aware loading with fallback -->
<script>
(function() {
  // Early Video Interception - Prevent modal videos from loading before 3D model
  const interceptedVideos = new Map();
  
  function interceptVideo(video) {
    if (video.src && !video.hasAttribute('data-lazy-src')) {
      // Check if video is in a modal container
      const modalContainer = video.closest('[id^="station-"], [data-modal], [data-modal-id]');
      if (modalContainer) {
        console.log('ðŸš« Early intercepting modal video:', video.src);
        const originalSrc = video.src;
        video.removeAttribute('src');
        video.setAttribute('data-lazy-src', originalSrc);
        interceptedVideos.set(video, originalSrc);
        
        // Add placeholder styling
        video.style.backgroundColor = 'rgba(0,0,0,0.1)';
        video.style.position = 'relative';
        
        // Store reference for the main loader
        window.interceptedVideos = window.interceptedVideos || interceptedVideos;
      }
    }
  }
  
  // Intercept existing videos
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
      document.querySelectorAll('video[src]').forEach(interceptVideo);
    });
  } else {
    document.querySelectorAll('video[src]').forEach(interceptVideo);
  }
  
  // Watch for dynamically added videos
  const observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      mutation.addedNodes.forEach(function(node) {
        if (node.nodeType === 1) { // Element node
          if (node.tagName === 'VIDEO') {
            interceptVideo(node);
          } else {
            const videos = node.querySelectorAll && node.querySelectorAll('video[src]');
            if (videos) videos.forEach(interceptVideo);
          }
        }
      });
    });
  });
  
  observer.observe(document.documentElement, {
    childList: true,
    subtree: true
  });
  
  // Stop observing after page load
  window.addEventListener('load', function() {
    observer.disconnect();
  });
  
  // Try localhost first, then fallback to Vercel
  const localUrl = 'http://localhost:8080/src/scripts/simple-3d-loader.js';
  const vercelUrl = 'https://webflow-gunther-map.vercel.app/src/scripts/simple-3d-loader.js';
  
  function loadScript(url, fallbackUrl) {
    const script = document.createElement('script');
    script.src = url;
    
    script.onerror = function() {
      console.log('Failed to load from ' + url + ', trying fallback...');
      if (fallbackUrl) {
        const fallbackScript = document.createElement('script');
        fallbackScript.src = fallbackUrl;
        fallbackScript.onerror = function() {
          console.error('Failed to load router from both localhost and Vercel');
        };
        document.head.appendChild(fallbackScript);
      }
    };
    
    script.onload = function() {
      console.log('Successfully loaded router from: ' + url);
    };
    
    document.head.appendChild(script);
  }
  
  // Start loading process
  loadScript(localUrl, vercelUrl);
})();
</script>

<!-- Anti-Flash Styling (Critical - Load Immediately) -->
<style>
  #webgl-container,
  .webgl-container {
    background-color: #3c5e71 !important;
    transition: none !important;
  }
  
  .webgl-container canvas {
    display: block;
    width: 100% !important;
    height: 100% !important;
  }
    
  .nav_mobile_logo,
  .nav_button_wrap,
  .bottom_contain {
    opacity: 0;
    /* Don't use any positioning - let GSAP handle it completely */
  }
</style>